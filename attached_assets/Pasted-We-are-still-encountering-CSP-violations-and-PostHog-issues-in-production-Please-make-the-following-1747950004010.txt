We are still encountering CSP violations and PostHog issues in production. Please make the following updates and verify the entire CSP policy and PostHog configuration:

⸻

CSP Fixes in server/index.ts:
	1.	Add https://rivu-app.onrender.com to connect-src
	•	This is our actual backend used in production.
	•	Without this, fetch requests like /api/register fail due to CSP.
	2.	Add https://app.posthog.com to both script-src and connect-src
	•	posthog.com is incorrect. It must be app.posthog.com to allow analytics.
	3.	Optional: Remove or disable the Replit dev banner script for production
	•	This script is breaking CSP and is not needed outside development.

⸻

Example CSP Fix (in server/index.ts):

res.setHeader(
  'Content-Security-Policy',
  "default-src 'self'; " +
  "script-src 'self' https://cdn.plaid.com https://app.posthog.com 'unsafe-inline'; " +
  "style-src 'self' https://fonts.googleapis.com 'unsafe-inline'; " +
  "font-src 'self' https://fonts.gstatic.com; " +
  "img-src 'self' data: https:; " +
  "connect-src 'self' https://rivu-app.onrender.com https://api.tryrivu.com https://*.render.com https://cdn.plaid.com https://production.plaid.com https://app.posthog.com; " +
  "frame-src 'self' https://cdn.plaid.com; " +
  "object-src 'none';"
);

PostHog Fixes:
	•	Confirm that process.env.POSTHOG_API_KEY is being read correctly in the frontend.
	•	Ensure the PostHog instance is initialized like:

posthog.init(process.env.POSTHOG_API_KEY, {
  api_host: 'https://app.posthog.com'
});

If POSTHOG_API_KEY is missing or undefined, validate that the secrets are available both in Replit and in Render (production).

⸻

Final Tasks:
	•	Update TROUBLESHOOTING_GUIDE.md to reflect:
	•	The previous CSP issues
	•	Fixes applied (including directives added and PostHog correction)
	•	Date of fix
	•	Test from both desktop and mobile, in both incognito and cleared-cache modes, to confirm that:
	•	API requests (e.g., /api/register) succeed
	•	No CSP violations show up in browser DevTools
	•	PostHog initializes without warning
	•	Page analytics are being tracked

Let us know once this is resolved.